<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <title>
        <%= title %>
    </title>
    <style>
        .filter-section {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background: #f8f8f8;
            border-radius: 8px;
        }

        .filter-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: 500;
        }

        .filter-group input,
        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .filter-btn {
            padding: 8px 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .filter-btn:hover {
            background: #555;
        }

        .clear-btn {
            background: #999;
        }
    </style>
</head>

<body>
    <div class="home">
        <!-- Banner Section -->
        <div class="banner">
            <%- include('partials/header') %>
                <!-- Banner-Content -->
                <div class="banner-content">
                    <p class="banner-text">Style<br />&amp; Beauty</p>
                    <img src="/images/bannerImg.png" alt="banner-img" class="banner-img">
                </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <form class="filter-form" method="GET" action="/">
                <div class="filter-group">
                    <label for="category">Category</label>
                    <select name="category" id="category">
                        <option value="">All Products</option>
                        <option value="for-her" <%=filters.category==='for-her' ? 'selected' : '' %>>For Her</option>
                        <option value="for-him" <%=filters.category==='for-him' ? 'selected' : '' %>>For Him</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="minPrice">Min Price (£)</label>
                    <input type="number" name="minPrice" id="minPrice" placeholder="0" value="<%= filters.minPrice %>"
                        step="0.01">
                </div>
                <div class="filter-group">
                    <label for="maxPrice">Max Price (£)</label>
                    <input type="number" name="maxPrice" id="maxPrice" placeholder="100" value="<%= filters.maxPrice %>"
                        step="0.01">
                </div>
                <div class="filter-group">
                    <label for="limit">Items per page</label>
                    <select name="limit" id="limit">
                        <option value="4" <%= filters.limit == 4 ? 'selected' : '' %>>4</option>
                        <option value="8" <%= !filters.limit || filters.limit == 8 ? 'selected' : '' %>>8</option>
                        <option value="12" <%= filters.limit == 12 ? 'selected' : '' %>>12</option>
                        <option value="16" <%= filters.limit == 16 ? 'selected' : '' %>>16</option>
                    </select>
                </div>
                <button type="submit" class="filter-btn">Apply Filters</button>
                <a href="/" class="filter-btn clear-btn" style="text-decoration: none; display: inline-block;">Clear</a>
            </form>
        </div>

        <!-- PriceCut-Content -->
        <div class="pricecut-content">
            <div class="pricecut-content-img1">
                <img src="/images/cutprice.jpg" alt="pricecut-img" class="cutprice1-img">
                <div class="pricecut-img1-txt">
                    <p class="armani">ARMANI</p>
                    <p class="spring">Spring<br />Summer 14</p>
                </div>
            </div>
            <div class="pricecut-content-img2">
                <img src="/images/cutprice2.jpg" alt="pricecut-img" class="cutprice1-img">
                <div class="pricecut-img2-txt">
                    <p class="armani">DOLCE &amp; GABBANA</p>
                    <p class="spring">Fall<br />Winter 13/14</p>
                </div>
            </div>
            <div class="pricecut-content-img3">
                <img src="/images/cutprice3.jpg" alt="pricecut-img" class="cutprice1-img">
                <div class="pricecut-img3-txt">
                    <p class="armani">SALE</p>
                    <p class="spring">Prices cut<br />Up to 70%</p>
                </div>
            </div>
        </div>

        <% if (!filters.category || filters.category === 'for-her') { %>
        <!-- PRODUCTS FOR HER-Content -->
        <div class="products-for-her-content">
            <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                    <path fill="currentColor"
                        d="M11.166 23.963L22.36 17.5c1.43-.824 1.43-2.175 0-3L11.165 8.037c-1.43-.826-2.598-.15-2.598 1.5v12.926c0 1.65 1.17 2.326 2.598 1.5z" />
                </svg>
                <p>New products for her</p>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                    <path fill="currentColor"
                        d="M20.834 8.037L9.64 14.5c-1.43.824-1.43 2.175 0 3l11.194 6.463c1.43.826 2.598.15 2.598-1.5V9.537c0-1.65-1.17-2.326-2.598-1.5" />
                </svg>
            </span>
        </div>

        <!-- Carousel Section - For Her -->
        <div class="carousel-container">
            <div class="carousel-wrapper">
                <div class="carousel-track" id="carouselTrack">
                    <% forHerProducts.forEach(product=> { %>
                        <div class="product-card">
                            <div class="product-image">
                                <% if (product.onSale) { %>
                                    <span class="sale-badge">ON SALE</span>
                                    <% } %>
                                        <img src="<%= product.image %>" alt="<%= product.name %>">
                            </div>
                            <div class="product-info">
                                <div class="product-name">
                                    <%= product.name %>
                                </div>
                                <div class="product-price">
                                    <% if (product.onSale && product.originalPrice) { %>
                                        <span class="original-price">£<%= product.originalPrice.toFixed(2) %></span>
                                        <span class="current-price">£<%= product.price.toFixed(2) %></span>
                                        <% } else { %>
                                            <span class="regular-price">£<%= product.price.toFixed(2) %></span>
                                            <% } %>
                                </div>
                                <button class="add-to-cart-btn" onclick="addToCart('<%= product._id %>', '<%= product.name %>')" style="margin-top: 10px; padding: 8px 15px; background: rgb(222, 0, 70); color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 14px;">
                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                        <% }); %>
                </div>
            </div>

            <div class="carousel-dots" id="carouselDots"></div>
        </div>
        <% } %>

        <% if (!filters.category || filters.category === 'for-him') { %>
        <!-- PRODUCTS FOR HIM-Content -->
        <div class="products-for-her-content">
            <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                    <path fill="currentColor"
                        d="M11.166 23.963L22.36 17.5c1.43-.824 1.43-2.175 0-3L11.165 8.037c-1.43-.826-2.598-.15-2.598 1.5v12.926c0 1.65 1.17 2.326 2.598 1.5z" />
                </svg>
                <p>New products for him</p>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                    <path fill="currentColor"
                        d="M20.834 8.037L9.64 14.5c-1.43.824-1.43 2.175 0 3l11.194 6.463c1.43.826 2.598.15 2.598-1.5V9.537c0-1.65-1.17-2.326-2.598-1.5" />
                </svg>
            </span>
        </div>

        <!-- 2nd Carousel Section - For Him -->
        <div class="carousel-container">
            <div class="carousel-wrapper">
                <div class="carousel-track" id="carouselTrack2">
                    <% forHimProducts.forEach(product=> { %>
                        <div class="product-card">
                            <div class="product-image">
                                <% if (product.onSale) { %>
                                    <span class="sale-badge">ON SALE</span>
                                    <% } %>
                                        <img src="<%= product.image %>" alt="<%= product.name %>">
                            </div>
                            <div class="product-info">
                                <div class="product-name">
                                    <%= product.name %>
                                </div>
                                <div class="product-price">
                                    <% if (product.onSale && product.originalPrice) { %>
                                        <span class="original-price">£<%= product.originalPrice.toFixed(2) %></span>
                                        <span class="current-price">£<%= product.price.toFixed(2) %></span>
                                        <% } else { %>
                                            <span class="regular-price">£<%= product.price.toFixed(2) %></span>
                                            <% } %>
                                </div>
                                <button class="add-to-cart-btn" onclick="addToCart('<%= product._id %>', '<%= product.name %>')" style="margin-top: 10px; padding: 8px 15px; background: rgb(222, 0, 70); color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 14px;">
                                    <i class="fas fa-cart-plus"></i> Add to Cart
                                </button>
                            </div>
                        </div>
                        <% }); %>
                </div>
            </div>

            <div class="carousel-dots" id="carouselDots2"></div>
        </div>
        <% } %>

        <!-- Brand Section -->
        <section class="brands-section">
            <div class="brands-container">
                <div class="brand-item">
                    <img src="/images/client_1.png" alt="Zeisson">
                </div>
                <div class="brand-item">
                    <img src="/images/client_2.png" alt="Excerpt">
                </div>
                <div class="brand-item">
                    <img src="/images/client_3.png" alt="Folive">
                </div>
                <div class="brand-item">
                    <img src="/images/client_4.png" alt="Koparu">
                </div>
                <div class="brand-item">
                    <img src="/images/client_5.png" alt="Sohau">
                </div>
                <div class="brand-item">
                    <img src="/images/client_6.png" alt="Barook">
                </div>
            </div>
        </section>

        <%- include('partials/footer') %>
    </div>
    <script src="/js/script.js"></script>
    <script>
        // Add to Cart function
        function addToCart(productId, productName) {
            fetch('/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    productId: productId,
                    quantity: 1
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    // Update cart count
                    updateCartCount(data.cartCount || 0);
                    // Show success message
                    alert(productName + ' added to cart!');
                } else {
                    alert('Error adding to cart: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding to cart');
            });
        }

        // Update cart count in navbar
        function updateCartCount(count) {
            const cartCountEl = document.getElementById('cart-count');
            if (cartCountEl) {
                if (count > 0) {
                    cartCountEl.textContent = count;
                    cartCountEl.style.display = 'flex';
                } else {
                    cartCountEl.style.display = 'none';
                }
            }
        }

        // Load cart count on page load
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/cart/count')
                .then(res => res.json())
                .then(data => {
                    updateCartCount(data.count || data.cartCount || 0);
                })
                .catch(error => {
                    console.error('Error loading cart count:', error);
                    updateCartCount(0);
                });
        });
    </script>
</body>

</html>